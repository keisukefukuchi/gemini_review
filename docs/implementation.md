# 実装仕様書

## 概要

日々のタスク管理を行うElectronアプリケーションの実装仕様。

## 実装済み機能

### 1. タスク管理機能

#### タスクの基本操作
- ✅ タスクの作成（タイトル、メモ、期限を設定可能）
- ✅ タスクの編集（モーダルダイアログで編集）
- ✅ タスクの削除（確認ダイアログ表示、子タスクも削除）
- ✅ タスクの完了/未完了切り替え（チェックボックス）

#### タスクの階層構造
- ✅ サブタスクの追加（親タスクから直接追加可能）
- ✅ 階層表示（インデントで視覚的に表現）
- ✅ 展開/折りたたみ機能
- ✅ 親タスクと同じ日付に制限

#### タスクの並び替え
- ✅ ドラッグ&ドロップで順序変更
- ✅ @dnd-kitライブラリを使用
- ✅ 順序の永続化（データベースに保存）

### 2. 日付管理機能

- ✅ 日付選択（カレンダー入力）
- ✅ 前日/翌日への移動（ナビゲーションボタン）
- ✅ 日付表示（日本語形式: yyyy年M月d日(E)）
- ✅ 日付ごとのタスク一覧表示

### 3. 表示機能

- ✅ 完了済みタスクの表示/非表示切り替え
- ✅ 期限時刻の表示（⏰アイコン）
- ✅ メモの表示（📝アイコン、ホバーで全文表示）
- ✅ レスポンシブデザイン（モバイル対応）

### 4. UI/UX機能

- ✅ モダンなデザイン（マテリアルデザイン風）
- ✅ ホバーエフェクト
- ✅ トランジションアニメーション
- ✅ モーダルダイアログ（タスク編集）
- ✅ 確認ダイアログ（タスク削除）

## 技術実装詳細

### フロントエンド

#### コンポーネント構成
```
App.tsx
├── TaskList.tsx
│   └── TaskItem.tsx (再帰的)
├── TaskForm.tsx
└── TaskEditModal.tsx
```

#### 状態管理
- React Hooks (useState, useEffect)を使用
- グローバル状態管理ライブラリは未使用（シンプルな構成）

#### ドラッグ&ドロップ
- `@dnd-kit/core`: コア機能
- `@dnd-kit/sortable`: ソート可能なリスト
- `@dnd-kit/utilities`: ユーティリティ関数

#### API通信
- `axios`を使用
- エラーハンドリング実装
- 非同期処理（async/await）

### バックエンド

#### API実装
- FastAPIフレームワーク
- RESTful API設計
- Pydanticによるバリデーション

#### データベース
- SQLAlchemy ORM
- MySQL 8.0
- 自己参照外部キーで階層構造を実現

#### エラーハンドリング
- HTTPステータスコード適切に返却
- エラーメッセージを日本語で返却（必要に応じて）

### Electron統合

#### メインプロセス
- Pythonバックエンドの起動（オプション）
- ウィンドウ管理
- アプリケーションライフサイクル管理

#### レンダラープロセス
- Reactアプリケーション
- 通常のHTTP通信でバックエンドに接続

## データフロー

### タスク作成フロー
1. ユーザーが「+ タスクを追加」をクリック
2. TaskFormが表示される
3. ユーザーが情報を入力して送信
4. `taskApi.createTask()`が呼ばれる
5. POST `/api/v1/tasks`にリクエスト送信
6. バックエンドがデータベースに保存
7. フロントエンドがタスク一覧を再取得
8. UIが更新される

### タスク編集フロー
1. ユーザーが編集ボタンをクリック
2. TaskEditModalが表示される
3. ユーザーが情報を編集して保存
4. `taskApi.updateTask()`が呼ばれる
5. PUT `/api/v1/tasks/{id}`にリクエスト送信
6. バックエンドがデータベースを更新
7. フロントエンドがタスク一覧を再取得
8. UIが更新される

### ドラッグ&ドロップフロー
1. ユーザーがタスクをドラッグ
2. @dnd-kitがドラッグイベントを検知
3. ドロップ位置を検出
4. `handleReorderTasks()`が呼ばれる
5. 各タスクの`order_index`を更新（API呼び出し）
6. ローカル状態を更新（即座にUI反映）
7. エラー時は再取得で復元

## 制約事項

### タスクの階層構造
- サブタスクは親タスクと同じ日付でなければならない
- 循環参照は防止（アプリケーションレベルでチェック）
- タスク削除時は子タスクも削除（CASCADE）

### 期限設定
- 時間単位のみ（日を超えない）
- HH:MM形式で入力
- データベースにはTIME型で保存

### データベース
- MySQL 8.0以上が必要
- 文字セット: utf8mb4推奨

## 今後の拡張可能性

### 機能追加候補
- タスクの検索機能
- タスクのフィルタリング（期限、完了状態など）
- タスクのエクスポート/インポート
- タスクの繰り返し設定
- タスクの優先度設定
- タスクのタグ機能

### 技術的改善
- 状態管理ライブラリの導入（Redux, Zustandなど）
- オフライン対応（Service Worker）
- データの自動バックアップ
- 通知機能（期限リマインダー）

## パフォーマンス考慮

### フロントエンド
- タスク一覧の仮想スクロール（大量データ対応）
- メモ化（React.memo）の活用
- 不要な再レンダリングの防止

### バックエンド
- データベースクエリの最適化
- インデックスの適切な設定
- N+1問題の回避

### データベース
- インデックスの設定済み
  - `date`カラム
  - `parent_id`カラム
  - `date`と`order_index`の複合インデックス

## セキュリティ考慮

### 現状
- ローカル環境のみで動作
- 認証機能なし（単一ユーザー想定）
- SQLインジェクション対策（ORM使用）

### 将来的な改善
- 入力値のサニタイズ強化
- XSS対策の強化
- CSRF対策（必要に応じて）
